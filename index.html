
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hron's blog</title>
  <meta name="author" content="Gábor Garami" />

  
  <meta name="description" content="Az előző cikkben alapszinten megismerkedtünk az Nginx-szel,
valamint megtudtuk, mitől és miben gyorsabb, mint a kihívójának szánt Apache. Ebben, és a &hellip;" />
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="canonical" href="http://hron.me/" />
  <link href="/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="/stylesheets/blueprint/reset.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/blueprint/typography.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/application.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/code.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Hron's blog" type="application/atom+xml" />
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', "UA-20858841-1"]);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <div id="header"><!-- <hgroup>
  <h1><a href="/">Hron's blog</a></h1>
  
    <h2>Who want to fly with doves loses the treasure down here</h2>
  
</hgroup> -->
<a class="logo"><img src="/images/bear-logo.png" alt="bear with earphone"></a>
<div class="userbox">



  
  <form action="http://google.com/search" method="get" class="search">
    <!-- <fieldset role="search"> -->
      <input type="hidden" name="q" value="site:hron.me" />
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    <!-- </fieldset> -->
  </form>
  
  <div class="avatar"><a href="#" class="name">Hron's blog</a></div>
  <ul class="subscription usernav" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
  
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>

</ul>



</div>
</div>
  <!-- <nav role="navigation"><ul class="subscription usernav" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
  
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>

</ul>


</nav> -->
  <div id="main" class="site dashboard">
    <div class="pagehead">
      <nav rel="navigation">
        <ul class="actions">
             <li><a href="/">Kezdőlap</a></li>
             <li><a href="/about/">Bemutatkozás</a></li>
         </ul>
      </nav>
      
    </div>

    <div id="content" class="columns container">
      <div class="blog-index first">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/nginx-es-php/">Nginx és PHP</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>Az <a href="http://hron.me/blog/2013/01/nginx-bevezeto/">előző</a> cikkben alapszinten megismerkedtünk az Nginx-szel,
valamint megtudtuk, mitől és miben gyorsabb, mint a kihívójának szánt Apache.</p>

<p>Ebben, és a következő cikkben azt vizsgáljuk, hogy hogyan tudunk egy PHP alapú site-t futtatni vele, például
egy Drupal alapú portált.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/03/nginx-es-php/">More &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/hazi/">Házi, magam sütöttem</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>A cím az utolsó betűig igaz - de csak addig. Pár hete (hmm&#8230; hónapja?) jártam-keltem a KÖKI Terminálon nyílt Tescoban, és nem tudtam elmenni egy fahéjas sütemény mellett, nevetséges áron volt, &#8220;Hamar kész&#8221; - hirdette a felirat. Naná hogy vettem.</p>

<p>Ma jutottam el odáig, hogy megint eszembe jutott (egy fenét, pár napja kerestem valamit a fagyasztóban és szembejött), mondom pocsékba ne vesszen már, megcsinálom.</p>

<p>Szóval, vettem egy nagy levegőt, meg egy még nagyobb tepsit (úgy értem, a levegőnél&#8230;) és belevágtam. A címke szerint 80 percet kell pihentetni, hát gondoltam, ez nem olyan betű szerinti dolog, hogy percre kellene betartani, ebédcsinálás előtt kiraktam, ebéd + pihi után álltam neki megcsinálni. Volt az 90-120 perc is, de ki számolja&#8230;</p>

<p>Aztán olyat mondott a címke, hogy vegyek sütőpapírt, borítsam a tepisbe, és utána rá a sütit. Na most nekem elég sokféle papír kószál itthon, sütőpapír az pont nem. Mivel már belevágtam (az ilyet nem szabad visszafagyasztani, mert elég undorító lesz utána) így a sütőpapírt kicseréltem alufóliára, mert az volt itthon. A csere egyszerű volt, tepsiből nem létező sütőpapír kidob, alufólia beterít.</p>

<p>A következő utasítás az volt, hogy 185 fokon kell sütni. Mivel nekem csak ilyen nempontos gázsütőm van, belöktem 5-ös fokozatra, és felhúztam az órát öt percre, ha nagyon elszaladna a ló, ott még lehet korrigálni mondjuk egy 4-es fokozattal. Kimentem, semmi extra, rápörgettem még 5-öt a kisvekkerre (a címke 10-12 perces sütést ír, de ez valami sablonból van, sosem vettem még olyan terméket, amit tényleg meg lehett volna csinálni ennyi idő alatt. A jobbik esetben nyers volt, a rosszabbikban&#8230; hát&#8230; érdekesen sötét).</p>

<p>Csörgésre lustán kiballagtam (+1-2 perc), megvizsgáltam úgy szemileg, meg megbökdöstem a kés hegyével, lagymatag és puha volt, szóval kollektív döntésként született, hogy kell neki még 5 perc. Kisvekker orrát megtekertem megint.</p>

<p>Miután megint egy cikk kellős közepébe csörgött bele a határidő, így úgy döntöttem, hogy egy életem, egy halálom, én bizony ezt nem fogom visszarakni a sütőbe, lett légyen akármilyen is az a sütemény. Végül nem volt szükség ilyen kemény elhatározásra, a süti magától is nagyon szép állagú lett, picit barna, de az nem baj.</p>

<p><a target="_blank" title="Suti @ Tepsi" href="http://static.hron.me/imgpaste/blog/IMG_20130303_160141.jpg"><img src="http://static.hron.me/imgpaste/blog/IMG_20130303_160141.jpg" alt="Suti @ Tepsi" width="324" height="245" /></a></p>

<p>A kiszedéssel viszont megszenvedtem. Mondjuk úgy, hogy nem véletlen ajánlanak ehhez sütőpapírt, bár az is csak felezi a kiszedési időt, ellenben megkönnyíteni nem fogja. A fahéjas töltelék ugyanis elég ragaszkodó természetű, viszont engem annyira nem kedvel, inkább az alufólia iránt mutatott élénk érdeklődést. Végül több, mint 20 perces hősies küzdelem után rá tudtam beszélni arra, hogy egy rongyos, összetépett, ragacsos alufólia közel sem annyira vonzó, mint egy szép új kéztőrlővel leterített tiszta tányér.</p>

<p><a target="_blank" title="Suti @ Tanyer" href="http://static.hron.me/imgpaste/blog/IMG_20130303_161610.jpg"><img src="http://static.hron.me/imgpaste/blog/IMG_20130303_161610.jpg" alt="Suti @ Tanyer" width="324" height="245" /></a></p>

<p>Tanulságok:</p>

<ul>
<li>Kell venni egy tekercs sütőpapírt, akkor is, ha csak szökőévente egyszer támad ilyen ötletem.
Mivel nem romlik meg, nem szagosodik meg, valamint alig foglal helyet, így mindenképpen megéri,
főleg, mert elég sok időt megspórol.</li>
<li>Sose higyjünk a címkére írt sütési utasításnak vakon. Mindig ellenőrizzük szemileg a készülő
termék állagát, mert azt a címkét Átlag Istvánné szül. Mindegy Jolán számára írták, nem pedig nekünk.</li>
</ul>


<p>Ettől eltekintve ízre semmi probléma, a kicsit megkaramellizálódott alap pedig abszolút nem okoz problémát.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/rails-pre-commit-hook/">Rails pre-commit hook</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just created this small hook for my Rails projects. It helps me to make my codebase clean.</p>

<div><script src='https://gist.github.com/4774014.js?file=git-pre-commit-hook.rb'></script>
<noscript><pre><code>#!/usr/bin/env ruby

require 'erb'
require 'yaml'
require 'pp'

lines = %x{git diff-index --cached --name-only HEAD}.split(/[\r\n]+/)

ENV['RAILS_ENV'] = 'test'

lines.each do |file|
  if File.exists?(file) and file =~ /\.(rb|rake|god)$/
    print &quot;[SYNTAX] #{file} - &quot;
    ret = system(&quot;ruby -c '#{file}'&quot;)
    exit 1 unless ret

    if file =~ /_test\.rb$/
      print &quot;[UNIT  ] #{file} - &quot;
      unitcmd = &quot;ruby -Ilib:test #{file}&quot;
      unitcmd = &quot;bundle exec #{unitcmd}&quot; if File.exists?('Gemfile')
      ret = system(unitcmd)
      exit 1 unless ret
    end

    if file =~ /_spec\.rb$/
      print &quot;[SPEC  ] #{file} - &quot;
      rspeccmd = &quot;rspec #{file}&quot;
      rspeccmd = &quot;bundle exec #{rspeccmd}&quot; if File.exists?('Gemfile')
      ret = system(rspeccmd)
      exit 1 unless ret
    end
  end

  if File.exists?(file) and File.basename(file) =~ /^(Capfile|Gemfile|Guardfile|Rakefile|config.ru)$/
    print &quot;[SYNTAX] #{file} - &quot;
    ret = system(&quot;ruby -c '#{file}'&quot;)
    exit 1 unless ret
  end

  if File.exists?(file) and file =~ /\.feature$/
    print &quot;[ (::) ] #{file} - &quot;
    ENV['CUCUMBER_FORMAT'] = 'progress'
    cuccmd = &quot;cucumber #{file}&quot;
    cuccmd = &quot;bundle exec #{cuccmd}&quot; if File.exists?('Gemfile')
    ret = system(cuccmd)
    exit 1 unless ret
  end

  if File.exists?(file) and file =~ /\.(yml|yaml)$/
    print &quot;[SYNTAX] #{file} - &quot;
    begin
      # Load with erb to avoid problems with cucumber's yml
      erb = ERB.new(IO.read(file)).result(binding)
      yaml = YAML.load(erb)
      puts &quot;Syntax OK&quot;
    rescue SyntaxError =&gt; ex
      puts ex.message
      exit 1
    rescue ArgumentError =&gt; ex
      puts ex.message
      exit 1
    end
  end
end
</code></pre></noscript></div>


<p>You can clone it at <a href="https://gist.github.com/hron84/4774014">Gist</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/gitiles-install-howto/">Gitiles Install Howto</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>I sucked a bit with <a href="https://code.google.com/p/gitiles/">Gitiles</a>, Gerrit&#8217;s Gitweb implementation, because this project lacks an INSTALL file.</p>

<p>So, basically you have to do following:</p>

<ul>
<li><p>First, check out of the source:</p>

<p> <code>git clone https://gerrit.googlesource.com/gitiles</code></p></li>
<li><p>After you cloned the source, compile it with <a href="http://maven.apache.org/">Maven</a>:</p>

<p> <code>mvn package -Dmaven.test.skip=true</code></p></li>
</ul>


<p>  Now, you got <strong>gitiles-war-1.0-SNAPSHOT.war</strong> in gitiles-war/target folder. Deploy it under your application server, in this case I put it to Jetty&#8217;s webapps folder.</p>

<ul>
<li>Tricky part is coming: you will faced with an error message, what says some configuration options are missing. This is because you didn&#8217;t created any configuration file yet. By default, webapp searches its configuration in the webapp root folder, but - because jetty explodes this folder every restart, I decided to put it to some more persistent place. I am do not run any other thing under this Jetty than Gerrit and Gitiles, so I created the gitiles.config under Jetty&#8217;s etc folder:</li>
</ul>


<figure class='code'><figcaption><span>gitiles.config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>[gitiles]
</span><span class='line'>    # Repositories placed here
</span><span class='line'>    basePath = /srv/git/repositories
</span><span class='line'>    # Do not check they are exported
</span><span class='line'>    exportAll = true
</span><span class='line'>    # This URL will be displayed as clone URL. DO NOT FORGET TRAILING SLASH!
</span><span class='line'>    baseGitUrl = ssh://cr.hron.me:29418/
</span><span class='line'>    # Title of site (doh)
</span><span class='line'>    siteTitle  = Gitiles - kingmax.hron.me:/srv/git/repositories
</span><span class='line'>    # I dunno why, but it is have to be configured.
</span><span class='line'>    canonicalHostName = kingmax.hron.me
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The config file above is cool, but Gitiles still crying&#8230; yeah, because you have to tell where it should find that. To do this, you must export a System property <strong>com.google.gitiles.configPath</strong>. I was <em>very</em> lazy, so I edited jetty.xml and before last closing tag I pasted this:</li>
</ul>


<figure class='code'><figcaption><span>jetty.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;Call</span> <span class="na">class=</span><span class="s">&quot;java.lang.System&quot;</span> <span class="na">name=</span><span class="s">&quot;setProperty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Arg&gt;</span>com.google.gitiles.configPath<span class="nt">&lt;/Arg&gt;</span>
</span><span class='line'>    <span class="nt">&lt;Arg&gt;&lt;SystemProperty</span> <span class="na">name=</span><span class="s">&quot;jetty.home&quot;</span> <span class="na">default=</span><span class="s">&quot;.&quot;</span> <span class="nt">/&gt;</span>/etc/gitiles.config<span class="nt">&lt;/Arg&gt;</span>
</span><span class='line'><span class="nt">&lt;/Call&gt;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/nginx-bevezeto/">Nginx - Bevezetés</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>Ezen cikk a tervek szerint egy sorozat része lesz, amely majd szép lassan (ahogy időm engedi) kerül ki a blogra.</p>

<p>Lássuk tehát az első részt, mely - ahogy a cím is utal rá - egyfajta általános bemutatása lesz ennek a pici webszervernek.</p>

<h2>Mi az Nginx?</h2>

<p>Az <a href="http://www.nginx.org/">Nginx</a> neve az angol Engine X (X motor) kifejezésből származik, ejteni is eszerint kell, tehát <code>ˈen-jən eks</code>.</p>

<p>Magát a motort egy Igor Sysoev nevű srác fejleszti 2002 óta, a kód maga 2004-ben lett nyilvános. Az elsődleges cél egy
pehelysúlyú, ugynakkor skálázható webszerver létrehozása volt, mely képes egy online tartalomszolgáltatónál felmerülő legtöbb
problémával megbirkózni, például az ún. C10K problémával, a legtöbb akkori webszervernek ugyanis problémát okozott egyidejűleg több,
mint 10 000 kapcsolatot kezelni.</p>

<p>Jelenleg az Nginx a világ harmadik legnépszerűbb webszervere, a <a href="http://news.netcraft.com/archives/2012/">2012-es NetCraft felmérés</a> szerint az összes mért oldal 12.07%-át
Nginx segítségével szolgálják ki.</p>

<h2>Az Nginx előnyei</h2>

<p>De mi teszi oly népszerűvé ezt a furcsa nevű webszervert? Mi az, amiért egyre-másra jelennek meg leírások, tutorialok hozzá, ami
a legbiztosabb jele egy termék népszerűségének?</p>

<p>Az egyik kétségtelen ok a gyorsaság. Az Nginx statikus fájlok kiszolgálásában és proxyként is sokkal nagyobb sebességgel szolgál ki
elődjeinél. A Wordpress.com <a href="http://highscalability.com/blog/2012/9/26/wordpresscom-serves-70000-reqsec-and-over-15-gbitsec-of-traf.html">mérései</a> szerint - megfelelő gép mellett - az átlagos 70000 req/s simán elérhető vele.</p>

<p>Ennek az egyik oka az, hogy az Nginx nem feltétlenül forkol mindig külön processzt vagy szálat az új kapcsolatoknak, ahogy pl. az Apache
egyes feldolgozómoduljai (prefork, ITK) teszik, sőt erre nincs is szüksége, mert eseményalapú a feldolgozása, így nem csak több kapcsolatot,
de több eseményt is le tud egyetlen feldolgozó szál kezelni. Ennek köszönhető egyébként az is, hogy hasonló terhelés mellett a memóriaigénye
messze elmarad a klasszikus webszerverekétől. Erről bővebben <a href="http://www.ichilton.co.uk/blog/web/nginx-and-why-you-should-be-running-it-instead-of-or-at-least-in-front-of-apache-380.html">itt</a> lehet olvasni.</p>

<p>A másik oka az, hogy az Nginx sokkal agresszívebben cachel a memóriában az elődjeinél. Megfelelő konfigurálás és többé-kevésbé fix (nem, vagy ritkán
változó) tartalom mellett elérhető az, hogy gyakorlatilag a memóriából történjen a kiszolgálás.</p>

<p>A pufferelés egyébként nagyon sokrétűen konfigurálható, ugyanakkor nem a legkönnyebben emészthető téma.</p>

<p>Előnye még a jó minőségű dokumentáció. A legtöbb modulnak nagyon részletes dokumentációja van, néhány konkrét használati eseteket is bemutat,
mely teljes biztonsággal átvehető egy az egyben a saját konfigurációnkba.</p>

<p>További előnyeként szokták sorolni a konfigurációs fájl könnyű érthetőségét. Akik valamilyen C szintaxisú nyelvben (PHP, Perl, C/C++, Java, stb)
programoznak, azoknak nagyon is ismerős lehetnek a blokkok és a sorvégi pontosvesszök, melyekből a konfiguráció felépül.</p>

<p><em>A következő cikkben az Nginx és a PHP kapcsolatát fogom bemutatni, és példákon keresztül szemlélteni</em></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/avatar-tortenelem/">Avatar történelem</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>Este újra megnéztem az Avatar-t, éjjel pedig furcsa álmom volt. Gyakorlatilag továbbálmodtam a történetet, pedig ez ritka eset nálam.</p>

<p>Szóval, a sztori lényege az, hogy Jake, miután az emberek többsége elhagyja a bolygót, két ottmaradt tudóssal nekiáll felfedezni azt. Az gondolom
már a filmből is mindenki számára világos volt, hogy ez gyakorlatilag egy hatalmas, dúsan burjánzó dzsungel. Ami nem, az az, hogy a bolygón
vannak olyan helyek, &#8220;szent helyek&#8221;, ahova még a Navik se mennek túl sűrűn. Jake bemerészkedik az egyik ilyen helyre (amit persze a népe nem igazán helyesel,
de nem igazán tiltják meg, bár figyelmeztetik őt a veszélyre). Mint kiderül, ezek a helyek valójában romok, egy fejlett, de letűnt civilizáció romjai.</p>

<p>Ha hasonlítani kellene, akkor a földi dél-amerikai civilizációhoz hasonlítanám, azonban annál sokkal fejlettebb, idősebb civilizációról van szó. Azt tudjuk,
hogy a ma ismert Navik együtt élnek a természettel, igyekeznek minél kevesebb kárt okozni. Nos, elődeik kapcsolata a természettel ennél sokkal bonyolultabb
volt. Bár ők is természetimádó nép voltak, azért az nem okozott nekik gondot, hogy a nagy erdőségekből kis ligeteket csináljanak, miközben terjeszkedtek.</p>

<p>No, de vissza a sztorihoz. Szóval Jake bemerészkedik az egyik ilyen romba, felderíti, és találnak pár érdekes leletet, köztük néhány vésetekkel teli kőtáblát.
Ezeken főképp képek láthatóak, írás szinte alig, de annyit azért sikerül kiolvasni belőle, hogy itt egy fejlett civilizáció lakott, elég nagy lélekszámmal.
Találtak néhány térképet is a holdról, illetve olyan szintű leírásokat az óriásbolygóról, ami egyértelművé teszi, hogy űrutazásra képes fajról van szó.</p>

<p>Egy másik romban, találnak egy furcsa, fallal lezárt helységet. Majd&#8217; egy hónapjuk rámegy, mire sikerül kitalálni, hogy jussanak be. Bent két asztalt találnak,
két-két székkel, a mennyezeten pedig fura díszítésű panelek lógnak a két asztal felett. Az egyik kutató, aki korábban azt próbálta meg kitalálni, hogy milyen jellegű
mezőgazdasága volt a civilizációnak, fáradtan roskadt le az egyik székre&#8230; majd meglepően gyorsan el is aludt. Néhány perc múlva felébredt, és elmondta, hogy rájött
a megoldásra, ilyen és ilyen eszközöket használtak, stb. Mivel erre vonatkozóan eddig semmilyen bizonyítékot nem leltek, persze mindenki kételkedett a szavában.
Pár nappal később azonban felfedeztek pár mezőgazdasági témájú vésetet, ami pontosan megfelelt a kutató által vázoltaknak. Néhány további kísérlet után rájöttek, hogy
a szoba egyfajta tudástárként működik, letölti a betérő fejébe azokat a válaszokat, melyekre kiváncsi.</p>

<p>Jake közben talál egy kötáblát, tele neveknek és dátumoknak tűnő vésetekkel. Ő is kipróbálja a szobát, és valami különös történik&#8230;</p>

<p>Az a tábla valóban neveket tartalmazott, méghozzá különböző uralkodók neveit. Amikor Jake leül a szobában, egy név jár folyamatosan a fejében, a szoba pedig hozzáférhetővé
teszi számára ezen uralkodó naplóját. Mint kiderül, a Navik ősei nem volt egységes faj, az egyes klánok közt folyamatos volt a viszálykodás. Az az uralkodó, akinek a
naplójához Jake hozzáfért, az utolsók egyike volt. A faj hosszú életű volt, a száz helyi év teljesen átlagos kornak számított, a mai embernél talán valahol 50-60 évnek felel meg.
Az uralkodó naplójába gondosan feljegyezte az általa vívott harcok minden eseményét. Pusztító harcok voltak ezek, rengeteg áldozattal. A naplóbejegyzésekből azonban az is kiderül,
hogy írójuk belefásult a harcba, értelmetlennek találja, ő maga már nem is nagyon támadt, csak a városát védelmezte. Mivel tisztában van azzal, hogy nem győzhet, összedob egy csapatot nőkből és gyerekekből, akiket beküld az egyik erdőbe. Pár évvel később egy - közelebbről meg nem nevezett - fegyver elpusztítja az egész civilizációt, a naplót író uralkodó is teljesen véletlenül menekül meg.</p>

<p>Csatlakozik a menekültek csapatához, és elhatározzák, hogy újrakezdik, de az alapoktól. Megtiltja, hogy visszamenjenek a romokhoz (nem mintha nagyon lenne miért&#8230;), és
elkezdenek az ősi módon élni, gyűjtögetni, vadászni&#8230; Ő maga is csak egyszer megy vissza - a halála előtt nem sokkal -, hogy befejezze a naplóját.</p>

<p>A Navik faja tehát újrakezdés, visszatértek ősi gyökereikhez, és teljesen elfeledték a múltat.</p>

<p>Jake és csapata úgy dönt, hogy erről nem szólnak a Naviknak. Ha egyszer maguktól megtalálják a tudástárt, hát legyen, de nem látják értelmét annak, hogy ezt a népet
megbolygassák ilyen szörnyű emlékekkel.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/rails-polimorf-vilag/">Rails - polimorf világ</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>Azért vannak dolgok, amikkel lehet szépeket szívni.</p>

<p>A feladat valami olyasmi volt, hogy kell egy újrafelhasználható &#8220;cím&#8221; osztály, ami külön táblára is képeződne le, hogy ne a megfelelő táblákat terheljük feleslegesen, plusz a címek amúgy se mindig kellenek pl. a felhasználókezeléshez. Azért kell újrafelhasználhatónak lennie, mert két különböző dolog is használ címeket a rendszerben.</p>

<p>Nem akarom nagyon húzni az időt, az alábbi kód született rá:</p>

<figure class='code'><figcaption><span>Polimophic user profile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Address</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:addressable</span><span class="p">,</span> <span class="ss">:polymorphic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_many</span>  <span class="ss">:addresses</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="ss">:addressable</span>
</span><span class='line'>  <span class="n">has_one</span>   <span class="ss">:billing_address</span> <span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="ss">:addressable</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Address&#39;</span><span class="p">,</span> <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:billable</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:shippable</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">has_one</span>   <span class="ss">:shipping_address</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="ss">:addressable</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;Address&#39;</span><span class="p">,</span> <span class="ss">:conditions</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:shippable</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:billable</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Erre kedves barátom azt mondaná, hogy szép baleset. És akkor még nagyon finoman fogalmazna. Nézzük, mik azok a buktatók, amin át lehet esni egy ilyet nézve:</p>

<ul>
<li>A has_many asszociáció ugye azért kell, hogy legyen valami, ami polimorf. Elvben bele lehet suvasztani a has_one mellé is, de nekem egyébként is kell tudnom a címeket egyben
lekérni, akkor meg miért ne emelném ki?</li>
<li>Az előbbi asszociáció alapján definiálunk két hozzárendelést. Ugye itt a hangsúly a :conditions hashen van, ez mondja meg, hogy a polimorf tömbből mely adatok kellenek
(pontosabban, hogy az asszociáció alapján generált query-ben a WHERE feltétel hogyan bővüljön)</li>
<li>Az egyik trükk az, hogy mindenképp meg kell adni az osztályt is, ugyanis a has_one asszociáció <em>nem</em> kéri le ezt az infót a hivatkozott polimorf asszociációtól, hanem saját
maga áll neki találgatni - természetesen rosszul.</li>
<li>A másik trükk pedig, hogy mivel ez egy kétparaméteres, egymást kölcsönösen kizáró feltétel, így <em>mindkettőt</em> meg kell adni, különben létrehozáskor előjöhet olyan csúfság, hogy
valaki meghinteli a dupla false-t - vagyis úgy mentünk el pl. egy billing címet, hogy az elvész az :addresses tömb nevű fekete lyukban (van értelme amúgy a dupla false-nak is,
csak abból nem billing meg shipping címek lesznek, hanem csak címek). Azaz, mentéskor a billing_address-en keresztül mentünk, de a mentés után a billing_address pont ugyanolyan
<code>nil</code> lesz, mint előtte volt vala.</li>
</ul>


<p>Azért ezzel is sikerült egy jó órát szívni&#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/redishash-this-hash-is-a-db/">RedisHash - this hash is a db!</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>I started to understand how [Redis] is working and how can I use it in my projects. In my current project I collect some informations with background jobs, and store these informations in Redis. I choosen this way because these data should not be really persistent (that&#8217;s why I not decided to use MySQL as storage) because it can be collected quickly again if vanishes (it collected periodically) but I would like to access it quickly.</p>

<p>Redis has a beautiful interface to handle data. However, I usually like if the data storing logic is separated from my business logic. After some thinking I decided to store object in a easiest way I can: I store them in a &#8220;smart&#8221; hash. Basically, all hashes are key-value store, and Redis is a key-value store too. So, I extended ruby&#8217;s <code>Hash</code> class, and overriden some methods&#8230;</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/11/redishash-this-hash-is-a-db/">More &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/rubymine-es-teamcity/">RubyMine és TeamCity</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>Már régóta keresek egy olyan IDE-t, ami képes nem csak projektszinten kezelni és szintaxis-kiemelést adni a Ruby/Rails projektjeimnek,
de magát a nyelvet is &#8220;beszéli&#8221;, vagyis van például kódkiegészítés, refaktorálás, figyelmeztetések, etc, etc.
Az általam eddig ismert legkomolyabb IDE, a NetBeans is csak elég alapszinten beszélte a Ruby nyelvet - aztán ki is vették belőle a támogatást,
jelenleg a plugin folyamatosan haláltusáját vívja, 7.2-höz már meg sem jelent semmiféle verzió.</p>

<p>Egy StackOverflow böngészés során akadtam rá a JetBrains <a href="http://www.jetbrains.com/ruby/">RubyMine</a> nevű IDE-jére. Saját bevallásuk szerint az
eszköz képes nyelvi szinten is kezelni a Ruby-t, illetve támogatja az összes nagyobb teszkörnyezetet. Mivel amúgy is épp indítottam egy projektet,
úgy gondoltam, adok neki egy esélyt, hát legfeljebb letörlöm, és folytatom az eddigi módon, TextMate és Vim párossal. Szerencsére csalódtam. Pozitívan.
Hatalmasat.</p>

<p>A RubyMine ugyanis nem csak egyszerűen jó, hanem - amennyire tudom - a maga nemében jelenleg páratlan a piacon azzal, hogy tényleg hozza azt, amit ígér,
vagyis teljes mértékben támogatja a Ruby nyelvet és a Rails keretrendszert, sőt, még ennél is tovább megy, beépített támogatása van a lokalizációk kezeléséhez,
grafikusan mutatja, hogy mely mdoeljeink vannak adatbázisban, képes a Rails projekt szerkezetét Rails-aspektusú nézetben mutatni (ahol nem mappák és fájlok vannak,
hanem kategóriák, pl. Controllers, Models, Helpers), a kontrollerek akcióihoz hozzá tudja rendelni a nézeteket, partialokat, a refaktor során pedig olyan mélységekbe is
lemegy, amiről álmodni sem mertem soha - egy modell átnevezésekor képes a nézetekben is utánanézni az útvonal metódusoknak, és megfelelően átnevezni azokat!</p>

<p>Ezen felül csak úgy mellékesen, képes kezelni az <a href="http://rvm.io">RVM</a>-et, támogatja a <a href="http://gembundler.com/">Bundler</a>t, a Rails generátorokat, a Rake taszkokat, SCSS-t meg CoffeeScript-et, &#8230; meg ilyen kis semmiségeket is.</p>

<p>Az egyetlen probléma vele a kissé hiperaktív kódkiegészítése, ha leírok egy nyilat, rögtön ugrana rá, pedig én magamtól szoktam szóközt is ütni utána, de azzal meg
elfogadom az első lehetőséget is egyben - ami általában rossz ötlet. Biztos le lehet valahogy beszélni róla, majd utánanézek (de ha valaki tudja a tuti megoldást,
a komment doboz mindig nyitott az ilyesmikre :-) ), egyelőre még elviselem.</p>

<p>Jelenleg folyamatosan használom az épp aktív projektemhez, teljesen jól szolgál, bár még képességeinek csak szerény részét használom. Most egyelőre a 30 napos
próbaidőszakban vagyunk (dicséretes, hogy ez alatt sem ugrál föl valami kis ablak indításkor, hogy még 22.45 nap van hátra, és mostazonnal vedd meg - ez rém undorító,
ha tetszik, úgyis megveszem - főleg, mert lejár -, ha meg nem tetszik, akkor ez a kapacitálás csak ront a dolgon), ám azt gondolom, hogy a 66 euro a személyes licencért abszolút megéri.</p>

<p>Amit nem használok belőle (sem), az a Git integráció, nekem a git még mindig parancssoros dolgot jelent, egyszerűbb kiadni a <code>git co feature-awesome-stuff</code> parancsot,
mint GUI-ban kikattintgatni. Legalábbis szerintem.</p>

<p>A JetBrains honlapját tallózgatva (ismét) ráakadtam a <a href="http://www.jetbrains.com/teamcity/">TeamCity</a> nevű CI szerverre is, ezzel egyszer volt már egy futó kapcsolatom, de
valamiért nem sikerült telepíteni, és a végén Jenkins lett belőle. Most ismét kapott tőlem egy lehetőséget, hogy elinduljon, és meggyőzzön. Ezúttal mindkettő sikerült is neki.</p>

<p>A TeamCity-ről azt érdemes tudni, hogy egy olyan Continous Integration szerver (továbbiakban CI szerver), melyet nagyon egyszerű kezelni, és nagyon jól áttekinthető felületet
ad, még egy felületes szemlélő számára is (ezt muszáj volt elsütni :-) ).</p>

<p>A RubyMine fejlesztők blogján pedig találtam egy <a href="http://blog.jetbrains.com/ruby/2009/11/jetbrains-teamcity-continuous-integration-for-ruby/">írást</a>, mely borzasztóan felcsigázta a kíváncsiságomat.
Azt merték ugyanis állítani, hogy  TeamCity beépítetten képes kezelni a RSpec és a Cucumber tesztek kimenetét, arrol riportot készít, hibáról értesít. Plusz, a TeamCity beépítetten támogatja az XMPP alapú notifikációt, amit pl. a Jenkins csak pluginnel tud.</p>

<p>Sajnos a TeamCity egyik hiányossága, hogy ő viszont már csak korlátozott mértékben képes kezelni a Bundlert: képes felismerni a létét, és azon keresztül futtatni a rake taszkokat, de már pl. egy <code>bundle install</code> -t képtelen elengedni, azt kézzel kell egy külön Build Step-ben, viszonylag kacifántosan megoldani. Végül sikerült, de azért nem voltam felhőtlenül boldog.
Viszont az első teszteredmények feledtették velem az ezen a téren történt csalódást, mert pontosan azt kaptam, amit elvártam: mindenféle külön konfiguráció nélkül jelenítete meg a Cucumber es RSpec tesztek eredményét, ráadásul egy egészen barátságos felületen.</p>

<p>Tényleg nem JetBrains reklámnak szánom ezt a postot, de azért annyira érződik mindkét terméken, hogy ezeket olyanok fejlesztik, akik láttak már közelről Rails projektet, meg RVM-et, meg ilyesmit&#8230; például a Jenkins Ruby pluginjénél nem volt ilyen érzésem.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/logging-with-logstash/">Logging with Logstash</a></h1>
    
    
      <p class="meta">
        
      </p>
    
  </header>


  <div class="entry-content"><p>In these days I started looking up for an opensource, easy-to-use central logging system.
I read a lot of articles on the internet, and I found two good solution,
<a href="http://www.graylog2.org">Graylog2</a> and <a href="http://logstash.net/">LogStash</a>. Both system can
operate as syslog server and store our logs in database. I tried both system, and I
experienced both have small problems - but some of these problems are different.</p>

<h2>Graylog2</h2>

<p>Graylog has a very good-looking interface and a relative easy configuration file. It has
a lot of parameters, but the default configuraiton file is well-documented and easy to read.</p>

<p>Graylog uses a MongoDB for store some small stuffs and ElasticSearch for store and search logs.
The main advantage of this solution is the separated web interface. It can be installed anywhere,
it just need a some small configurations to connect to same ES/Mongo instances as Graylog server uses.</p>

<p>The web ui makes easy to search and filter logs, backlist some entries, and create a &#8220;channels&#8221; what is
a named filter setting, where you can follow what happening in a simple context.</p>

<p>But as I started use web interface and the server itself in everyday tasks, I found two problems:</p>

<ul>
<li>Web interface is does not make easy to write filters, because nor the interface, nor the documentation
not describe how filters will be matched against messages. Because these filters are simple regular
expressions, it is needed to know how to search some specific things. I sucked with it a lot of time
until I found a method to find something. It is need a lot of improvement.</li>
<li>Graylog seems does not take care about its input. After a week I found logging is stopped working. After
some investigation, I discovered the ElasticSearch eaten a lot of resources and generating a huge log.
After reading log I found the ElasticSearch is broken on some invalid characters in index files. I
tried to restart ES server and leave to recover itself for a hour but no luck, it stuck in recovering state.
Because I am not know well ES and graylog I started ask Google about these problems, but I did not find a
good solution for me. So I decided to move on from Graylog.</li>
</ul>


<h2>LogStash</h2>

<p>LogStash is a more robust logging solution. It is similar as syslog-ng but it does not restrict itself to working
as Syslog server (with other words: get infos from input like syslog server) but it can chew anything what is a text
stuff. It can use a lot of things as a log source, e.g.:</p>

<ul>
<li>Syslog server (it can act as syslog server, but see below)</li>
<li>Plain file</li>
<li>Raw TCP/UDP socket</li>
<li>Output of any executable</li>
<li>IRC/Jabber channels</li>
<li>Twitter</li>
<li>Stdin</li>
<li>Windows Eventlog</li>
<li>and so on&#8230;</li>
</ul>


<p>And it has a numerous output format too. What is important for me is it can use ElasticSearch and some No-SQL
databases as log-storing backend.</p>

<p>It has a built-in web interface for searching in log records, but <a href="https://github.com/rashidkpc/Kibana/">Kibana</a>
is a little better Web interface to search against ElasticSearch, it makes searching/filtering easier.</p>

<p>My current configuration is very easy:</p>

<ul>
<li>There is a central syslog server, provided by LogStash</li>
<li>All my server is logging here via RSyslog (default syslog server of Debian Linux)</li>
<li>LogStash is configured to store log messages in ElasticSearch after some parsing</li>
</ul>


<p>Basically, I followed the <a href="http://cookbook.logstash.net/recipes/syslog-pri/">official recipe</a> for this setup except
one thing: somehow I couldn&#8217;t get working the date parser in the way what recipe says. So I tricked it out.</p>

<p>First, I created an Rsyslog config part, what I uploaded to /etc/rsyslog.d on every server:</p>

<figure class='code'><figcaption><span>/etc/rsyslog.d/to-logstash.conf</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$template LOGSTASH,&quot;&lt;%PRI%&gt;%timegenerated:::date-rfc3164-buggyday% %HOSTNAME% %APP-NAME%: %msg:::drop-last-lf%\n&quot;
</span><span class='line'>$ActionForwardDefaultTemplate LOGSTASH
</span><span class='line'>*.*   @1.2.3.4:514
</span></code></pre></td></tr></table></div></figure>


<p>Note the <code>%timegenerated:::date-rfc3164-buggyday%</code> directive. The documentation of Rsyslog says it is basically
pads a day number with zero if it is smaller than 10. It is introduced to emulate a syslog-ng &#8216;bug&#8217;.</p>

<p>After it I created a following configuration for logstash:</p>

<figure class='code'><figcaption><span>LogStash configuration</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>input {
</span><span class='line'>  tcp {
</span><span class='line'>    port =&gt; 514
</span><span class='line'>    type =&gt; syslog
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  udp {
</span><span class='line'>    port =&gt; 514
</span><span class='line'>    type =&gt; syslog
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>filter {
</span><span class='line'>  grok {
</span><span class='line'>      type =&gt; &quot;syslog&quot;
</span><span class='line'>      pattern =&gt; [ &quot;&lt;%{POSINT:syslog_pri}&gt;%{SYSLOGTIMESTAMP:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{PROG:syslog_program}(?:\[%{POSINT:syslog_pid}\])?: %{GREEDYDATA:syslog_message}&quot; ]
</span><span class='line'>      add_field =&gt; [ &quot;received_at&quot;, &quot;%{@timestamp}&quot; ]
</span><span class='line'>      add_field =&gt; [ &quot;received_from&quot;, &quot;%{@source_host}&quot; ]
</span><span class='line'>  }
</span><span class='line'>  syslog_pri {
</span><span class='line'>      type =&gt; &quot;syslog&quot;
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  date {
</span><span class='line'>      type =&gt; &quot;syslog&quot;
</span><span class='line'>  #    syslog_timestamp =&gt; [ &quot;MMM  d HH:mm:ss&quot;, &quot;MMM dd HH:mm:ss&quot; ]
</span><span class='line'>      syslog_timestamp =&gt; [ &quot;MMM dd HH:mm:ss&quot; ]
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  mutate {
</span><span class='line'>      type =&gt; &quot;syslog&quot;
</span><span class='line'>      exclude_tags =&gt; &quot;_grokparsefailure&quot;
</span><span class='line'>      replace =&gt; [ &quot;@source_host&quot;, &quot;%{syslog_hostname}&quot; ]
</span><span class='line'>      replace =&gt; [ &quot;@message&quot;, &quot;%{syslog_message}&quot; ]
</span><span class='line'>  }
</span><span class='line'>  mutate {
</span><span class='line'>      type =&gt; &quot;syslog&quot;
</span><span class='line'>      remove =&gt; [ &quot;syslog_hostname&quot;, &quot;syslog_message&quot;, &quot;syslog_timestamp&quot; ]
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>output {
</span><span class='line'>  elasticsearch {
</span><span class='line'>    index =&gt; &quot;syslog-%{+YYYY.MM.dd}&quot;
</span><span class='line'>    embedded =&gt; false
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  #stdout { debug =&gt; true debug_format =&gt; json }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'># vim: ts=2 sw=2 et
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Note the commented out date mapping. This is what original recipe says but I always got an exception
related to parser and DateFormat what complaining about invalid data in the date. With buggyday hack
on Rsyslog side I made dates 2-digit long, so it will always be parsed, I hope. It will reveals at least
Nov 1.</p>

<p>The last output stuff is just for debugging, it displays the parsed object in JSON format, this is a way
how can you check your all filter working correctly.</p>

<p>I sucked with parsing the message because my old rsyslog template has a typo and I could not imagine, what
failing.
After some digging, I found jls-grok RubyGem is contains a same parser what LogStash uses, so you can
check your filters via IRB. Just make sure you using 1.9.3 ruby, because Ruby 1.8 throws a SyntaxError
when you try <code>require 'grok-pure'</code> (what is recommended, because the simple &#8216;grok&#8217; is searching a C lib).</p>

<figure class='code'><figcaption><span>Simple example for testing Grok filter</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;grok-pure&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">grok</span> <span class="o">=</span> <span class="no">Grok</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># I extracted patterns dir from jar package</span>
</span><span class='line'><span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;patterns/*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">grok</span><span class="o">.</span><span class="n">add_patterns_from_file</span> <span class="n">f</span> <span class="p">}</span>
</span><span class='line'><span class="n">s</span><span class="o">=</span><span class="s2">&quot;Oct 27 19:01:09&quot;</span>
</span><span class='line'><span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;%{SYSLOGTIMESTAMP:syslog_timestamp}&#39;</span>
</span><span class='line'><span class="n">grok</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</span><span class='line'><span class="nb">p</span> <span class="n">grok</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="o">.</span><span class="n">to_a</span> <span class="c1"># =&gt; [&quot;Oct 27 19:01:09&quot;, &quot;Oct 27 19:01:09&quot;, &quot;Oct&quot;, &quot;27&quot;, &quot;19:01:09&quot;, &quot;19&quot;, &quot;01&quot;, &quot;09&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can use exactly same pattern as you use in LogStash configuration file.</p>

<p><strong>Note:</strong> If you see a <code>_grokparsefailure</code> tag in your tag list, then you do something wrong. This means
the filter what you using in first filter does not match correctly on your syslog message from Rsyslog.
The good news is LogStash stop evaluating filters on the first failing in debug mode, and leave @message
untouched (if you see the second mutate from end, you can see we replace @message with the content of
syslog_message, and remove unneccessary fields in the last mutate filter). If somehow it falls through
the grok filter and removes the original (raw) message, then simply comment out the last two filter by
prefixing lines with a hashmark.</p>

<p>As you see in the config  use an external ES server, not the embedded one, because I currently have a
working and configured ES instance, and I would like to use that. No other reason to not use embedded
ES server: if you currently not have an ES instance, then simply use what shipped with LogStash.</p>

<p>The embedded web interface of LogStash is a bit tricky thing, because I could not start as documentation says
via the java command, I had to extract the jar file and run standalone to check its user interface.
Don&#8217;t expect something cool: It is just a textfield with a button and contains a link with a basic
query string what filters messages generated today.</p>

<h2>Conclusion</h2>

<p>I think Graylog is a great logging solution, but it needs some love for prevent crashing ES server with
invalid characters in the stored data. But the web interface and easy configuration makes it very,
really very lovely.</p>

<p>LogStash is a good solution if you want to handle multiple log sources or you want to validate/manipulate
your log messages or you want to distribute logs to multiple destinations. I think LogStash is a little
overkill if you just want a central syslog server, however - this is working as expected. So I took my
two cent on LogStash and not on Graylog - even if I would like to prefer Graylog.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar last">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/03/nginx-es-php/">Nginx és PHP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/hazi/">Házi, magam sütöttem</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/rails-pre-commit-hook/">Rails pre-commit hook</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/gitiles-install-howto/">Gitiles Install Howto</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/nginx-bevezeto/">Nginx - Bevezetés</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <ul id="category-list"><li><a href='/blog/tags/android'>android (1)</a></li><li><a href='/blog/tags/bear'>bear (3)</a></li><li><a href='/blog/tags/blog'>blog (1)</a></li><li><a href='/blog/tags/brno'>brno (2)</a></li><li><a href='/blog/tags/centos'>centos (1)</a></li><li><a href='/blog/tags/continous-deployment'>continous deployment (1)</a></li><li><a href='/blog/tags/cooking'>cooking (1)</a></li><li><a href='/blog/tags/cookinig'>cookinig (1)</a></li><li><a href='/blog/tags/drupal'>drupal (2)</a></li><li><a href='/blog/tags/en'>en (7)</a></li><li><a href='/blog/tags/fantasy'>fantasy (1)</a></li><li><a href='/blog/tags/gentoo'>gentoo (1)</a></li><li><a href='/blog/tags/git'>git (2)</a></li><li><a href='/blog/tags/google-authenticator'>google authenticator (1)</a></li><li><a href='/blog/tags/hetkoznapok'>hetkoznapok (14)</a></li><li><a href='/blog/tags/hirek'>hirek (1)</a></li><li><a href='/blog/tags/hogyan'>hogyan (5)</a></li><li><a href='/blog/tags/hu'>hu (82)</a></li><li><a href='/blog/tags/humor'>humor (1)</a></li><li><a href='/blog/tags/humour'>humour (1)</a></li><li><a href='/blog/tags/it'>it (33)</a></li><li><a href='/blog/tags/java'>java (2)</a></li><li><a href='/blog/tags/jenkins'>jenkins (2)</a></li><li><a href='/blog/tags/jetty'>jetty (1)</a></li><li><a href='/blog/tags/konyha'>konyha (3)</a></li><li><a href='/blog/tags/linux'>linux (15)</a></li><li><a href='/blog/tags/mac'>mac (2)</a></li><li><a href='/blog/tags/nem-kategorizalt'>nem-kategorizalt (7)</a></li><li><a href='/blog/tags/nginx'>nginx (2)</a></li><li><a href='/blog/tags/openid'>openid (1)</a></li><li><a href='/blog/tags/php'>php (2)</a></li><li><a href='/blog/tags/pic'>pic (3)</a></li><li><a href='/blog/tags/posterous'>posterous (1)</a></li><li><a href='/blog/tags/programozas'>programozas (6)</a></li><li><a href='/blog/tags/qt'>qt (1)</a></li><li><a href='/blog/tags/rails'>rails (7)</a></li><li><a href='/blog/tags/recipe'>recipe (1)</a></li><li><a href='/blog/tags/repository'>repository (1)</a></li><li><a href='/blog/tags/ruby'>ruby (7)</a></li><li><a href='/blog/tags/rvm'>rvm (1)</a></li><li><a href='/blog/tags/ssh'>ssh (1)</a></li><li><a href='/blog/tags/sysadmin'>sysadmin (1)</a></li><li><a href='/blog/tags/tech'>tech (2)</a></li><li><a href='/blog/tags/testing'>testing (1)</a></li><li><a href='/blog/tags/teszt'>teszt (1)</a></li><li><a href='/blog/tags/thinking'>thinking (2)</a></li><li><a href='/blog/tags/travel'>travel (2)</a></li><li><a href='/blog/tags/tudomany'>tudomany (6)</a></li><li><a href='/blog/tags/tutorial'>tutorial (5)</a></li><li><a href='/blog/tags/utazas'>utazas (1)</a></li><li><a href='/blog/tags/windows'>windows (4)</a></li><li><a href='/blog/tags/wordpress'>wordpress (1)</a></li></ul>
</section>
<section>
    <h1>StackOverflow Profile</h1>
    <p>
        <a href="http://stackoverflow.com/users/182474/gabor-garami">
            <img src="http://stackoverflow.com/users/flair/182474.png" width="208" height="58" alt="profile for Gabor Garami at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for Gabor Garami at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
        </a>
    </p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/hron84">@hron84</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'hron84',
            count: 4,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("hron84", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/hron84" class="twitter-follow-button" data-show-count="false">Follow @hron84</a>
  
</section>


  
</aside>
<div class="rule">&nbsp;</div>

    </div>
  </div>
  <footer role="contentinfo"><div id="footer" class="clearfix">
  <div class="site">
    <div class="copy">
      
      Copyright &copy; 2013 - Gábor Garami &mdash; Some rights reserved<br/>
      <small class="license">
        Contents and design are licensed under the terms of <br/>
        <a href="http://creativecommons.org/licenses/by-sa/3.0/">
          <img src="/images/cc.png" alt="creativecommons" />
          &nbsp;CreativeCommons BY-SA 3.0 Unported License</a>
      </small>
    </div>
    <div class="powa">
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span><br/>
      <span class="credit">Hosted by <a href="https://github.com/">GitHub Pages</a></span>
    </div>
  </div>
</div>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hron84';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
